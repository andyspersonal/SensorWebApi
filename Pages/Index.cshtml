@page
@{
    ViewData["Title"] = "Index";
}

<script type="text/javascript">

   function showTemperature() {
      $("#temperature").html("Getting Temperature");
      var promise = GetLatestTemperature();
      promise.done(function (data) {
         $("#temperature").html(data.temperature + ' ' + '&deg;C');
         var day = moment(data.takenDateTime);
         $('#dateTaken').html(day.format("DD/MM/YYYY HH:mm:ss"));
      });
   }

   function showMaxTemperature() {
      $("#maxTemperature").html("Getting Temperature");
      var promise = GetMaxTemperature(moment().format("YYYY-MM-DD"));
      promise.done(function (data) {
         $("#maxTemperature").html(data.temperature + ' ' + '&deg;C');
         var day = moment(data.takenDateTime);
         $('#maxTempDateTaken').html(day.format("DD/MM/YYYY HH:mm:ss"));
      });
      promise.fail(function (jqXHR, status, error) {
         if (jqXHR.status == 404) {
            $("#maxTemperature").html('no readings');
            $('#maxTempDateTaken').html('');
         }
      });
          
   }

   function showMinTemperature() {
      $("#minTemperature").html("Getting Temperature");
      var promise = GetMinTemperature(moment().format("YYYY-MM-DD"));
      promise.done(function (data) {
         $("#minTemperature").html(data.temperature + ' ' + '&deg;C');
         var day = moment(data.takenDateTime);
         $('#minTempDateTaken').html(day.format("DD/MM/YYYY HH:mm:ss"));
      });
      promise.fail(function (jqXHR, status, error) { 
         if (jqXHR.status == 404) {
            $("#minTemperature").html('no readings');
            $('#minTempDateTaken').html('');

         }
      });


   }


   function showAllTemperatures() {
      showTemperature();
      showMaxTemperature();
      showMinTemperature();
      
   }
          
   
   $(document).ready(showAllTemperatures );
</script>

<div class="container">
   <div class="row">
      <div class="col-sm">
         <h1>Last Temperature</h1>
         <h3 id="temperature">Temperature</h3>
         <h3 id="dateTaken">Date Taken</h3>
      </div>
      <div class="col-sm">
         <h1>Max Today</h1>
         <h3 id="maxTemperature">Temperature</h3>
         <h3 id="maxTempDateTaken">Date Taken</h3>
      </div>
      <div class="col-sm">
         <h1>Min Today</h1>
         <h3 id="minTemperature">Temperature</h3>
         <h3 id="minTempDateTaken">Date Taken</h3>
      </div>
   </div>
      <div class="row">
         <div class="col-sm">
            <script type="text/javascript">
               google.charts.setOnLoadCallback(drawChart);
               function drawChart() {
             
                  //get the temperature form the server
                  var promise = GetLatestTemperature();
                  promise.done(function (data) {
                     var tmp = data.temperature;
                     drawChart2(tmp);
                  });
               }
               function drawChart2(tmp) {
                  var data = google.visualization.arrayToDataTable([
                     ['Label', 'Value'],
                     ['Last', tmp]
                  ]);

                  var options = {
                     width: 400, height: 120,
                     greenFrom: -10, greenTo: 0,
                     redFrom: 20, redTo: 40,
                     yellowFrom: 0, yellowTo: 20,
                     minorTicks: 5,
                     min: -10,
                     max: 40,
                     greenColor: '#0000ff',
                     yellowColor: '#ffffff'


                  };

                  var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
                  chart.draw(data, options);
               }
            </script>
            <div id="chart_div" style="width:400px; height: 120px;"></div>
         </div>
         <div class="col-sm">

         </div>
         <div class="col-sm">

         </div>
      </div>
  

    <p><button type="button" class="btn  btn-primary" id="btn" value="get temp" onclick="showAllTemperatures()">Get Temperatures</button></p>

</div>
